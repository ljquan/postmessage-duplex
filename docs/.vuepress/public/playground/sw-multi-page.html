<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Service Worker å¤šé¡µé¢é€šè®¯æ¼”ç¤º - postmessage-duplex</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .header p {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .nav {
      background: white;
      padding: 12px 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .nav a {
      color: #667eea;
      text-decoration: none;
      font-size: 14px;
    }
    
    .nav a:hover {
      text-decoration: underline;
    }
    
    .nav .sep {
      color: #ddd;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .intro-panel {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .intro-panel h2 {
      font-size: 18px;
      color: #2c3e50;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .intro-panel p {
      color: #606266;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 12px;
    }
    
    .feature-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    
    .feature-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .feature-icon {
      font-size: 20px;
    }
    
    .feature-text {
      font-size: 13px;
      color: #606266;
    }
    
    .apps-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 900px) {
      .apps-container {
        grid-template-columns: 1fr;
      }
    }
    
    .app-frame-container {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .app-frame-header {
      padding: 12px 16px;
      background: #f8f9fa;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .app-frame-title {
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .app-badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 4px;
      color: white;
    }
    
    .app-badge.app1 {
      background: #667eea;
    }
    
    .app-badge.app2 {
      background: #3eaf7c;
    }
    
    .app-frame-actions {
      display: flex;
      gap: 8px;
    }
    
    .app-frame-actions button {
      padding: 4px 12px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .app-frame-actions button:hover {
      border-color: #667eea;
      color: #667eea;
    }
    
    .app-iframe {
      width: 100%;
      height: 520px;
      border: none;
      display: block;
    }
    
    .architecture-panel {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .architecture-panel h2 {
      font-size: 18px;
      color: #2c3e50;
      margin-bottom: 16px;
    }
    
    .architecture-diagram {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    
    .diagram-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      margin-bottom: 20px;
    }
    
    .diagram-box {
      padding: 16px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      min-width: 140px;
    }
    
    .diagram-box.app1 {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    
    .diagram-box.app2 {
      background: linear-gradient(135deg, #3eaf7c, #2d8f62);
      color: white;
    }
    
    .diagram-box.sw {
      background: linear-gradient(135deg, #ff9800, #f57c00);
      color: white;
    }
    
    .diagram-arrow {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #909399;
      font-size: 12px;
    }
    
    .diagram-arrow-line {
      width: 2px;
      height: 30px;
      background: #ddd;
      position: relative;
    }
    
    .diagram-arrow-line::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 8px solid #ddd;
    }
    
    .diagram-arrow-line.up::after {
      top: 0;
      bottom: auto;
      border-top: none;
      border-bottom: 8px solid #ddd;
    }
    
    .diagram-label {
      margin-top: 4px;
    }
    
    .code-section {
      margin-top: 20px;
    }
    
    .code-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: -1px;
    }
    
    .code-tab {
      padding: 8px 16px;
      background: #f0f2f5;
      border: 1px solid #ddd;
      border-bottom: none;
      border-radius: 6px 6px 0 0;
      cursor: pointer;
      font-size: 13px;
      color: #606266;
    }
    
    .code-tab.active {
      background: #1e1e1e;
      color: white;
      border-color: #1e1e1e;
    }
    
    .code-block {
      background: #1e1e1e;
      border-radius: 0 6px 6px 6px;
      padding: 16px;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 13px;
      color: #d4d4d4;
      line-height: 1.5;
    }
    
    .code-block .keyword { color: #569cd6; }
    .code-block .string { color: #ce9178; }
    .code-block .function { color: #dcdcaa; }
    .code-block .comment { color: #6a9955; }
    .code-block .variable { color: #9cdcfe; }
    
    .tips {
      margin-top: 16px;
      padding: 12px 16px;
      background: #e7f3ff;
      border-radius: 8px;
      border-left: 4px solid #409eff;
    }
    
    .tips-title {
      font-size: 14px;
      font-weight: 600;
      color: #409eff;
      margin-bottom: 8px;
    }
    
    .tips-content {
      font-size: 13px;
      color: #606266;
      line-height: 1.6;
    }
    
    .tips-content ol {
      margin-left: 20px;
      margin-top: 8px;
    }
    
    .tips-content li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Service Worker å¤šé¡µé¢é€šè®¯æ¼”ç¤º</h1>
    <p>ä¸€ä¸ª Service Worker ä¸å¤šä¸ªç‹¬ç«‹åº”ç”¨é¡µé¢ä¹‹é—´çš„åŒå·¥é€šè®¯</p>
  </div>
  
  <div class="nav">
    <a href="./parent.html">Iframe ç¤ºä¾‹</a>
    <span class="sep">|</span>
    <a href="./sw-demo.html">SW åŸºç¡€ç¤ºä¾‹</a>
    <span class="sep">|</span>
    <a href="./sw-multi-page.html" style="font-weight: bold;">SW å¤šé¡µé¢ç¤ºä¾‹</a>
  </div>
  
  <div class="container">
    <div class="intro-panel">
      <h2>åœºæ™¯è¯´æ˜</h2>
      <p>
        åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸€ä¸ª Service Worker å¯èƒ½éœ€è¦åŒæ—¶æœåŠ¡å¤šä¸ªä¸åŒçš„é¡µé¢æˆ–åº”ç”¨æ¨¡å—ã€‚
        æœ¬ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ postmessage-duplex å®ç°ï¼š
      </p>
      <div class="feature-list">
        <div class="feature-item">
          <span class="feature-icon">ğŸ”—</span>
          <span class="feature-text">å¤šå®¢æˆ·ç«¯ç‹¬ç«‹è¿æ¥</span>
        </div>
        <div class="feature-item">
          <span class="feature-icon">ğŸ“¡</span>
          <span class="feature-text">æ¶ˆæ¯å¹¿æ’­æœºåˆ¶</span>
        </div>
        <div class="feature-item">
          <span class="feature-icon">ğŸ¯</span>
          <span class="feature-text">æŒ‰ç±»å‹å®šå‘æ¨é€</span>
        </div>
        <div class="feature-item">
          <span class="feature-icon">ğŸ”„</span>
          <span class="feature-text">åŒå‘å®æ—¶é€šè®¯</span>
        </div>
      </div>
    </div>
    
    <div class="apps-container">
      <div class="app-frame-container">
        <div class="app-frame-header">
          <div class="app-frame-title">
            <span class="app-badge app1">åº”ç”¨ 1</span>
            è´­ç‰©è½¦æ¨¡å—
          </div>
          <div class="app-frame-actions">
            <button onclick="reloadApp1()">åˆ·æ–°</button>
            <button onclick="openApp1()">æ–°çª—å£æ‰“å¼€</button>
          </div>
        </div>
        <iframe id="app1Frame" class="app-iframe" src="./sw-app1.html"></iframe>
      </div>
      
      <div class="app-frame-container">
        <div class="app-frame-header">
          <div class="app-frame-title">
            <span class="app-badge app2">åº”ç”¨ 2</span>
            ç”¨æˆ·ä¸­å¿ƒ
          </div>
          <div class="app-frame-actions">
            <button onclick="reloadApp2()">åˆ·æ–°</button>
            <button onclick="openApp2()">æ–°çª—å£æ‰“å¼€</button>
          </div>
        </div>
        <iframe id="app2Frame" class="app-iframe" src="./sw-app2.html"></iframe>
      </div>
    </div>
    
    <div class="architecture-panel">
      <h2>é€šè®¯æ¶æ„</h2>
      
      <div class="architecture-diagram">
        <div class="diagram-row">
          <div class="diagram-box app1">åº”ç”¨ 1<br><small>è´­ç‰©è½¦æ¨¡å—</small></div>
          <div class="diagram-box app2">åº”ç”¨ 2<br><small>ç”¨æˆ·ä¸­å¿ƒ</small></div>
        </div>
        
        <div class="diagram-row">
          <div class="diagram-arrow">
            <div class="diagram-arrow-line"></div>
            <span class="diagram-label">ç‚¹å¯¹ç‚¹: publish/subscribe<br>å¹¿æ’­: onBroadcast</span>
          </div>
          <div class="diagram-arrow">
            <div class="diagram-arrow-line"></div>
            <span class="diagram-label">ç‚¹å¯¹ç‚¹: publish/subscribe<br>å¹¿æ’­: onBroadcast</span>
          </div>
        </div>
        
        <div class="diagram-row">
          <div class="diagram-box sw">Service Worker<br><small>æ¶ˆæ¯è·¯ç”± & å¹¿æ’­ä¸­å¿ƒ</small></div>
        </div>
        
        <div style="margin-top: 16px; display: flex; justify-content: center; gap: 30px; font-size: 12px; color: #666;">
          <div><span style="color: #409eff;">â—</span> ç‚¹å¯¹ç‚¹: è¯·æ±‚â†’å“åº”</div>
          <div><span style="color: #e6a23c;">â—</span> å¹¿æ’­: å•å‘é€šçŸ¥</div>
        </div>
      </div>
      
      <div class="tips">
        <div class="tips-title">æ“ä½œæŒ‡å—</div>
        <div class="tips-content">
          <ol>
            <li>åˆ†åˆ«ç‚¹å‡»ä¸¤ä¸ªåº”ç”¨çš„ã€Œè¿æ¥ SWã€æŒ‰é’®ï¼Œå»ºç«‹ä¸ Service Worker çš„è¿æ¥</li>
            <li><strong>ç‚¹å¯¹ç‚¹é€šè®¯</strong>ï¼šä½¿ç”¨ publish/subscribeï¼Œæœ‰å“åº”ï¼Œé€‚åˆæ•°æ®è¯·æ±‚ï¼ˆå¦‚è·å–è´­ç‰©è½¦ã€ç”¨æˆ·ä¿¡æ¯ï¼‰</li>
            <li><strong>å¹¿æ’­é€šè®¯</strong>ï¼šä½¿ç”¨ broadcast/onBroadcastï¼Œæ— å“åº”ï¼Œé€‚åˆé€šçŸ¥å’Œäº‹ä»¶æ¨é€</li>
            <li>å°è¯•ã€Œå¹¿æ’­ç»™æ‰€æœ‰ã€å’Œã€Œå¹¿æ’­ç»™XXã€æŒ‰é’®ï¼Œè§‚å¯Ÿå¦ä¸€ä¸ªåº”ç”¨æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯</li>
            <li>è§‚å¯Ÿé€šè®¯æ—¥å¿—ï¼Œæ³¨æ„åŒºåˆ†ç‚¹å¯¹ç‚¹æ¶ˆæ¯å’Œå¹¿æ’­æ¶ˆæ¯çš„ä¸åŒ</li>
          </ol>
        </div>
      </div>
      
      <div class="code-section">
        <div class="code-tabs">
          <div class="code-tab active" onclick="showCodeTab(0, this)">ç‚¹å¯¹ç‚¹é€šè®¯</div>
          <div class="code-tab" onclick="showCodeTab(1, this)">å¹¿æ’­é€šè®¯</div>
          <div class="code-tab" onclick="showCodeTab(2, this)">SW ç«¯å®ç°</div>
          <div class="code-tab" onclick="showCodeTab(3, this)">å¯¹æ¯”æ€»ç»“</div>
        </div>
        
        <div class="code-block" id="codeBlock">
<span class="comment">// ========== ç‚¹å¯¹ç‚¹é€šè®¯ï¼ˆè¯·æ±‚-å“åº”æ¨¡å¼ï¼‰ ==========</span>

<span class="comment">// 1. è¿æ¥ Service Worker</span>
<span class="keyword">const</span> <span class="variable">channel</span> = <span class="keyword">await</span> <span class="variable">ServiceWorkerChannel</span>.<span class="function">createFromPage</span>()

<span class="comment">// 2. å‘é€è¯·æ±‚å¹¶ç­‰å¾…å“åº”ï¼ˆpublish è¿”å› Promiseï¼‰</span>
<span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="variable">channel</span>.<span class="function">publish</span>(<span class="string">'getCart'</span>, { <span class="variable">userId</span>: <span class="string">'123'</span> })
<span class="keyword">if</span> (<span class="variable">response</span>.<span class="variable">ret</span> === <span class="variable">ReturnCode</span>.<span class="variable">Success</span>) {
  <span class="variable">console</span>.<span class="function">log</span>(<span class="string">'è´­ç‰©è½¦æ•°æ®:'</span>, <span class="variable">response</span>.<span class="variable">data</span>)
}

<span class="comment">// 3. æ¥æ”¶ç‚¹å¯¹ç‚¹æ¶ˆæ¯ï¼ˆsubscribe éœ€è¦è¿”å›å“åº”ï¼‰</span>
<span class="variable">channel</span>.<span class="function">subscribe</span>(<span class="string">'directMessage'</span>, ({ <span class="variable">data</span> }) => {
  <span class="variable">console</span>.<span class="function">log</span>(<span class="string">'æ”¶åˆ°æ¶ˆæ¯:'</span>, <span class="variable">data</span>.<span class="variable">message</span>)
  <span class="keyword">return</span> { <span class="variable">received</span>: <span class="keyword">true</span> }  <span class="comment">// è¿”å›å“åº”ç»™å‘é€æ–¹</span>
})
        </div>
      </div>
    </div>
  </div>

  <script>
    function reloadApp1() {
      document.getElementById('app1Frame').src = './sw-app1.html';
    }
    
    function reloadApp2() {
      document.getElementById('app2Frame').src = './sw-app2.html';
    }
    
    function openApp1() {
      window.open('./sw-app1.html', '_blank');
    }
    
    function openApp2() {
      window.open('./sw-app2.html', '_blank');
    }
    
    const codeSnippets = [
      // ç‚¹å¯¹ç‚¹é€šè®¯
      `<span class="comment">// ========== ç‚¹å¯¹ç‚¹é€šè®¯ï¼ˆè¯·æ±‚-å“åº”æ¨¡å¼ï¼‰ ==========</span>

<span class="comment">// 1. è¿æ¥ Service Worker</span>
<span class="keyword">const</span> <span class="variable">channel</span> = <span class="keyword">await</span> <span class="variable">ServiceWorkerChannel</span>.<span class="function">createFromPage</span>()

<span class="comment">// 2. å‘é€è¯·æ±‚å¹¶ç­‰å¾…å“åº”ï¼ˆpublish è¿”å› Promiseï¼‰</span>
<span class="keyword">const</span> <span class="variable">response</span> = <span class="keyword">await</span> <span class="variable">channel</span>.<span class="function">publish</span>(<span class="string">'getCart'</span>, { <span class="variable">userId</span>: <span class="string">'123'</span> })
<span class="keyword">if</span> (<span class="variable">response</span>.<span class="variable">ret</span> === <span class="variable">ReturnCode</span>.<span class="variable">Success</span>) {
  <span class="variable">console</span>.<span class="function">log</span>(<span class="string">'è´­ç‰©è½¦æ•°æ®:'</span>, <span class="variable">response</span>.<span class="variable">data</span>)
}

<span class="comment">// 3. æ¥æ”¶ç‚¹å¯¹ç‚¹æ¶ˆæ¯ï¼ˆsubscribe éœ€è¦è¿”å›å“åº”ï¼‰</span>
<span class="variable">channel</span>.<span class="function">subscribe</span>(<span class="string">'directMessage'</span>, ({ <span class="variable">data</span> }) => {
  <span class="variable">console</span>.<span class="function">log</span>(<span class="string">'æ”¶åˆ°æ¶ˆæ¯:'</span>, <span class="variable">data</span>.<span class="variable">message</span>)
  <span class="keyword">return</span> { <span class="variable">received</span>: <span class="keyword">true</span> }  <span class="comment">// è¿”å›å“åº”ç»™å‘é€æ–¹</span>
})`,
      
      // å¹¿æ’­é€šè®¯
      `<span class="comment">// ========== å¹¿æ’­é€šè®¯ï¼ˆå•å‘æ— å“åº”ï¼‰ ==========</span>

<span class="comment">// 1. ä½¿ç”¨ onBroadcast æ¥æ”¶å¹¿æ’­ï¼ˆæ— éœ€è¿”å›å€¼ï¼‰</span>
<span class="variable">channel</span>.<span class="function">onBroadcast</span>(<span class="string">'globalBroadcast'</span>, ({ <span class="variable">data</span> }) => {
  <span class="variable">console</span>.<span class="function">log</span>(<span class="string">'æ”¶åˆ°å¹¿æ’­:'</span>, <span class="variable">data</span>.<span class="variable">message</span>)
  <span class="comment">// æ— éœ€è¿”å›å€¼ - å¹¿æ’­æ˜¯å•å‘çš„</span>
})

<span class="comment">// 2. æ¥æ”¶è´­ç‰©è½¦æ›´æ–°å¹¿æ’­</span>
<span class="variable">channel</span>.<span class="function">onBroadcast</span>(<span class="string">'cartUpdated'</span>, ({ <span class="variable">data</span> }) => {
  <span class="variable">console</span>.<span class="function">log</span>(<span class="string">'è´­ç‰©è½¦å·²æ›´æ–°:'</span>, <span class="variable">data</span>.<span class="variable">itemCount</span>, <span class="string">'ä»¶å•†å“'</span>)
})

<span class="comment">// 3. ç§»é™¤å¹¿æ’­ç›‘å¬</span>
<span class="variable">channel</span>.<span class="function">offBroadcast</span>(<span class="string">'globalBroadcast'</span>)

<span class="comment">// æ³¨æ„ï¼šå¹¿æ’­æ¶ˆæ¯å¸¦æœ‰ _broadcast: true æ ‡è®°</span>
<span class="comment">// ç”± Service Worker è´Ÿè´£å‘é€ç»™å„å®¢æˆ·ç«¯</span>`,
      
      // SW ç«¯å®ç°
      `<span class="comment">// Service Workerï¼šå‘é€å¹¿æ’­æ¶ˆæ¯</span>
<span class="variable">subscribeMap</span>[<span class="string">'broadcastToAll'</span>] = <span class="keyword">async</span> ({ <span class="variable">data</span> }) => {
  <span class="keyword">const</span> <span class="variable">clients</span> = <span class="keyword">await</span> self.<span class="variable">clients</span>.<span class="function">matchAll</span>()
  
  <span class="keyword">for</span> (<span class="keyword">const</span> <span class="variable">client</span> <span class="keyword">of</span> <span class="variable">clients</span>) {
    <span class="keyword">const</span> <span class="variable">channel</span> = <span class="variable">clientChannels</span>.<span class="function">get</span>(<span class="variable">client</span>.<span class="variable">id</span>)
    <span class="keyword">if</span> (<span class="variable">channel</span>) {
      <span class="comment">// ä½¿ç”¨ _broadcast: true æ ‡è®°å¹¿æ’­æ¶ˆæ¯</span>
      <span class="keyword">await</span> <span class="variable">channel</span>.<span class="function">sendMessage</span>({
        <span class="variable">cmdname</span>: <span class="string">'globalBroadcast'</span>,
        <span class="variable">data</span>: { <span class="variable">message</span>: <span class="variable">data</span>.<span class="variable">message</span> },
        <span class="variable">_broadcast</span>: <span class="keyword">true</span>  <span class="comment">// å…³é”®æ ‡è®°</span>
      })
    }
  }
  <span class="keyword">return</span> { <span class="variable">clientCount</span>: <span class="variable">clients</span>.<span class="variable">length</span> }
}

<span class="comment">// ç‚¹å¯¹ç‚¹è¯·æ±‚å¤„ç†ï¼ˆæœ‰å“åº”ï¼‰</span>
<span class="variable">subscribeMap</span>[<span class="string">'getCart'</span>] = <span class="keyword">async</span> () => {
  <span class="keyword">return</span> { <span class="variable">items</span>: [...], <span class="variable">total</span>: <span class="variable">99.99</span> }
}`,
      
      // å¯¹æ¯”æ€»ç»“
      `<span class="comment">// ========== ç‚¹å¯¹ç‚¹ vs å¹¿æ’­ å¯¹æ¯” ==========</span>

<span class="comment">// ç‚¹å¯¹ç‚¹ï¼ˆpublish/subscribeï¼‰</span>
<span class="comment">// âœ… æœ‰å“åº”ï¼Œé€‚åˆæ•°æ®è¯·æ±‚</span>
<span class="comment">// âœ… æ”¯æŒè¶…æ—¶å¤„ç†</span>
<span class="comment">// âœ… subscribe å¤„ç†å™¨éœ€è¦è¿”å›å€¼</span>
<span class="keyword">const</span> <span class="variable">res</span> = <span class="keyword">await</span> <span class="variable">channel</span>.<span class="function">publish</span>(<span class="string">'getData'</span>, {...})
<span class="variable">channel</span>.<span class="function">subscribe</span>(<span class="string">'msg'</span>, () => { <span class="keyword">return</span> {...} })

<span class="comment">// å¹¿æ’­ï¼ˆ_broadcast/onBroadcastï¼‰</span>
<span class="comment">// âœ… æ— å“åº”ï¼Œé€‚åˆé€šçŸ¥å’Œäº‹ä»¶</span>
<span class="comment">// âœ… fire-and-forget æ¨¡å¼</span>
<span class="comment">// âœ… onBroadcast å¤„ç†å™¨æ— éœ€è¿”å›å€¼</span>
<span class="variable">channel</span>.<span class="function">onBroadcast</span>(<span class="string">'notify'</span>, ({ <span class="variable">data</span> }) => {
  <span class="comment">// å¤„ç†é€šçŸ¥ï¼Œæ— éœ€è¿”å›</span>
})

<span class="comment">// SW å‘é€å¹¿æ’­æ—¶æ·»åŠ  _broadcast: true</span>
<span class="variable">channel</span>.<span class="function">sendMessage</span>({ <span class="variable">cmdname</span>: <span class="string">'x'</span>, <span class="variable">_broadcast</span>: <span class="keyword">true</span> })`
    ];
    
    function showCodeTab(index, tabEl) {
      document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
      tabEl.classList.add('active');
      document.getElementById('codeBlock').innerHTML = codeSnippets[index];
    }
  </script>
</body>
</html>
