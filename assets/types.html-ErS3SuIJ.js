import{_ as n,c as a,a as e,o as p}from"./app-BZDL3wne.js";const l={};function t(c,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="类型定义" tabindex="-1"><a class="header-anchor" href="#类型定义"><span>类型定义</span></a></h1><p>本页列出 postmessage-duplex 的所有类型定义。</p><h2 id="communicator" tabindex="-1"><a class="header-anchor" href="#communicator"><span>Communicator</span></a></h2><p>通讯器接口，定义了通道的核心方法。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">Communicator<span class="token operator">&lt;</span>TMethods <span class="token keyword">extends</span> Methods <span class="token operator">=</span> Methods<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token doc-comment comment">/** 通道是否就绪 */</span></span>
<span class="line">  isReady<span class="token operator">:</span> <span class="token builtin">boolean</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 通道是否已销毁 */</span></span>
<span class="line">  isDestroyed<span class="token operator">:</span> <span class="token builtin">boolean</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 发送消息并等待响应 */</span></span>
<span class="line">  <span class="token function">publish</span><span class="token punctuation">(</span></span>
<span class="line">    cmdname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> </span>
<span class="line">    data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> </span>
<span class="line">    options<span class="token operator">?</span><span class="token operator">:</span> PublishOptions</span>
<span class="line">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>PostResponse<span class="token operator">&gt;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 类型安全的远程方法调用 */</span></span>
<span class="line">  <span class="token generic-function"><span class="token function">call</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> TMethods<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span></span>
<span class="line">    methodName<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">,</span> </span>
<span class="line">    params<span class="token operator">:</span> MethodParams<span class="token operator">&lt;</span>TMethods<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TypedPostResponse<span class="token operator">&lt;</span>MethodReturn<span class="token operator">&lt;</span>TMethods<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;&gt;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 订阅消息 */</span></span>
<span class="line">  <span class="token function">subscribe</span><span class="token punctuation">(</span>cmdname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> PostCallback<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 一次性订阅 */</span></span>
<span class="line">  <span class="token function">once</span><span class="token punctuation">(</span>cmdname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> PostCallback<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 取消订阅 */</span></span>
<span class="line">  <span class="token function">unSubscribe</span><span class="token punctuation">(</span>cmdname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 销毁通道 */</span></span>
<span class="line">  <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="postresponse" tabindex="-1"><a class="header-anchor" href="#postresponse"><span>PostResponse</span></a></h2><p>响应数据结构。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">PostResponse</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token doc-comment comment">/** 请求 ID，用于关联请求和响应 */</span></span>
<span class="line">  requestId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 返回码 */</span></span>
<span class="line">  ret<span class="token operator">:</span> ReturnCode</span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 响应数据 */</span></span>
<span class="line">  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 错误信息 */</span></span>
<span class="line">  msg<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 时间戳 */</span></span>
<span class="line">  time<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="typedpostresponse" tabindex="-1"><a class="header-anchor" href="#typedpostresponse"><span>TypedPostResponse</span></a></h2><p>类型安全的响应数据结构。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">TypedPostResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Omit<span class="token operator">&lt;</span>PostResponse<span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token doc-comment comment">/** 强类型的响应数据 */</span></span>
<span class="line">  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="postrequest" tabindex="-1"><a class="header-anchor" href="#postrequest"><span>PostRequest</span></a></h2><p>请求数据结构。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">PostRequest</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token doc-comment comment">/** 请求 ID */</span></span>
<span class="line">  requestId<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 命令/事件名称 */</span></span>
<span class="line">  cmdname<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 请求数据 */</span></span>
<span class="line">  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 时间戳 */</span></span>
<span class="line">  time<span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 配对密钥 */</span></span>
<span class="line">  peerKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="channeloption" tabindex="-1"><a class="header-anchor" href="#channeloption"><span>ChannelOption</span></a></h2><p>通道配置选项。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">ChannelOption</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token doc-comment comment">/** </span>
<span class="line">   * 请求超时时间（毫秒）</span>
<span class="line">   * <span class="token keyword">@default</span> 5000</span>
<span class="line">   */</span></span>
<span class="line">  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** </span>
<span class="line">   * 自定义日志对象</span>
<span class="line">   * 需要实现 log, warn, error 方法</span>
<span class="line">   */</span></span>
<span class="line">  log<span class="token operator">?</span><span class="token operator">:</span> Console</span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** </span>
<span class="line">   * 预定义订阅映射</span>
<span class="line">   * 键为命令名，值为回调函数</span>
<span class="line">   */</span></span>
<span class="line">  subscribeMap<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> PostCallback<span class="token operator">&gt;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** </span>
<span class="line">   * 最大消息大小（字节）</span>
<span class="line">   * <span class="token keyword">@default</span> 1048576 (1MB)</span>
<span class="line">   */</span></span>
<span class="line">  maxMessageSize<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** </span>
<span class="line">   * 速率限制（每秒消息数）</span>
<span class="line">   * <span class="token keyword">@default</span> 100</span>
<span class="line">   */</span></span>
<span class="line">  rateLimit<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="publishoptions" tabindex="-1"><a class="header-anchor" href="#publishoptions"><span>PublishOptions</span></a></h2><p>发布消息的选项。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">PublishOptions</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token doc-comment comment">/** </span>
<span class="line">   * 此次请求的超时时间（毫秒）</span>
<span class="line">   * 覆盖通道的默认超时设置</span>
<span class="line">   */</span></span>
<span class="line">  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** </span>
<span class="line">   * 可传输对象数组</span>
<span class="line">   * 用于高效传输 ArrayBuffer 等大数据</span>
<span class="line">   * 注意：传输后原对象会被清空</span>
<span class="line">   */</span></span>
<span class="line">  transferables<span class="token operator">?</span><span class="token operator">:</span> Transferable<span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="postcallback" tabindex="-1"><a class="header-anchor" href="#postcallback"><span>PostCallback</span></a></h2><p>消息回调函数类型。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">type</span> <span class="token class-name">PostCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> PostResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">any</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>说明：</strong></p><ul><li>返回 <code>void</code>：不发送响应</li><li>返回其他值：作为响应数据发送</li><li>返回 <code>Promise</code>：等待 Promise 解析后发送响应</li></ul><h2 id="returncode" tabindex="-1"><a class="header-anchor" href="#returncode"><span>ReturnCode</span></a></h2><p>返回码枚举。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">enum</span> ReturnCode <span class="token punctuation">{</span></span>
<span class="line">  <span class="token doc-comment comment">/** 成功 */</span></span>
<span class="line">  Success <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 接收方回调执行错误 */</span></span>
<span class="line">  ReceiverCallbackError <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 发送方回调执行错误 */</span></span>
<span class="line">  SendCallbackError <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 未订阅该事件 */</span></span>
<span class="line">  NoSubscribe <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">  </span>
<span class="line">  <span class="token doc-comment comment">/** 请求超时 */</span></span>
<span class="line">  TimeOut <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">99</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="methods" tabindex="-1"><a class="header-anchor" href="#methods"><span>Methods</span></a></h2><p>远程方法类型定义的基类型。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">type</span> <span class="token class-name">Methods</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>示例：</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">MyMethods</span> <span class="token keyword">extends</span> <span class="token class-name">Methods</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">getData</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">setData</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line">  <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> pong<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="methodparams" tabindex="-1"><a class="header-anchor" href="#methodparams"><span>MethodParams</span></a></h2><p>提取方法参数类型的工具类型。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">type</span> <span class="token class-name">MethodParams<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>示例：</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">Methods</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">getData</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> <span class="token class-name">Params</span> <span class="token operator">=</span> MethodParams<span class="token operator">&lt;</span>Methods<span class="token punctuation">[</span><span class="token string">&#39;getData&#39;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token comment">// { id: number }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="methodreturn" tabindex="-1"><a class="header-anchor" href="#methodreturn"><span>MethodReturn</span></a></h2><p>提取方法返回类型的工具类型。</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">type</span> <span class="token class-name">MethodReturn<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">never</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>示例：</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">Methods</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">getData</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> <span class="token class-name">Return</span> <span class="token operator">=</span> MethodReturn<span class="token operator">&lt;</span>Methods<span class="token punctuation">[</span><span class="token string">&#39;getData&#39;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token comment">// { name: string }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用示例" tabindex="-1"><a class="header-anchor" href="#使用示例"><span>使用示例</span></a></h2><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> </span>
<span class="line">  IframeChannel<span class="token punctuation">,</span></span>
<span class="line">  ReturnCode<span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">type</span> <span class="token class-name">PostResponse</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">type</span> <span class="token class-name">ChannelOption</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">type</span> <span class="token class-name">Methods</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">type</span> <span class="token class-name">MethodParams</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">type</span> <span class="token class-name">MethodReturn</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;postmessage-duplex&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义远程方法</span></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">RemoteMethods</span> <span class="token keyword">extends</span> <span class="token class-name">Methods</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">getUser</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">updateUser</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> data<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  email<span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 配置</span></span>
<span class="line"><span class="token keyword">const</span> options<span class="token operator">:</span> ChannelOption <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  timeout<span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span></span>
<span class="line">  log<span class="token operator">:</span> <span class="token builtin">console</span><span class="token punctuation">,</span></span>
<span class="line">  subscribeMap<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">ping</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> pong<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 创建通道</span></span>
<span class="line"><span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IframeChannel<span class="token operator">&lt;</span>RemoteMethods<span class="token operator">&gt;</span></span><span class="token punctuation">(</span>iframe<span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 类型安全的调用</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">channel</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&#39;getUser&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>ret <span class="token operator">===</span> ReturnCode<span class="token punctuation">.</span>Success <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// response.data 类型为 { name: string; email: string }</span></span>
<span class="line">    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>msg<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用工具类型</span></span>
<span class="line"><span class="token keyword">type</span> <span class="token class-name">GetUserParams</span> <span class="token operator">=</span> MethodParams<span class="token operator">&lt;</span>RemoteMethods<span class="token punctuation">[</span><span class="token string">&#39;getUser&#39;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token comment">// { id: number }</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> <span class="token class-name">GetUserReturn</span> <span class="token operator">=</span> MethodReturn<span class="token operator">&lt;</span>RemoteMethods<span class="token punctuation">[</span><span class="token string">&#39;getUser&#39;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token comment">// { name: string; email: string }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,45)])])}const i=n(l,[["render",t]]),r=JSON.parse('{"path":"/api/types.html","title":"类型定义","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1769418463000,"contributors":[{"name":"liquidliang","username":"liquidliang","email":"ljquan@qq.com","commits":1,"url":"https://github.com/liquidliang"}],"changelog":[{"hash":"288e378422593e39667c397bec9bbbf25465b67a","time":1769418463000,"email":"ljquan@qq.com","author":"liquidliang","message":"init"}]},"filePathRelative":"api/types.md"}');export{i as comp,r as data};
