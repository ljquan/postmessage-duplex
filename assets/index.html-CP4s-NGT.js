import{_ as t,c as i,b as n,d as e,w as l,a as o,r as c,o as r,e as p}from"./app-BZDL3wne.js";const u={};function d(m,s){const a=c("RouteLink");return r(),i("div",null,[s[23]||(s[23]=n("h1",{id:"api-参考",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#api-参考"},[n("span",null,"API 参考")])],-1)),s[24]||(s[24]=n("p",null,"本节提供 postmessage-duplex 的完整 API 文档。",-1)),s[25]||(s[25]=n("h2",{id:"核心类",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#核心类"},[n("span",null,"核心类")])],-1)),n("table",null,[s[6]||(s[6]=n("thead",null,[n("tr",null,[n("th",null,"类"),n("th",null,"描述")])],-1)),n("tbody",null,[n("tr",null,[n("td",null,[e(a,{to:"/api/iframe-channel.html"},{default:l(()=>[...s[0]||(s[0]=[p("IframeChannel",-1)])]),_:1})]),s[1]||(s[1]=n("td",null,"用于 iframe 双工通讯",-1))]),n("tr",null,[n("td",null,[e(a,{to:"/api/service-worker-channel.html"},{default:l(()=>[...s[2]||(s[2]=[p("ServiceWorkerChannel",-1)])]),_:1})]),s[3]||(s[3]=n("td",null,"用于 Service Worker 双工通讯",-1))]),n("tr",null,[n("td",null,[e(a,{to:"/api/errors.html"},{default:l(()=>[...s[4]||(s[4]=[p("ChannelError",-1)])]),_:1})]),s[5]||(s[5]=n("td",null,"自定义错误类",-1))])])]),s[26]||(s[26]=n("h2",{id:"类型定义",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#类型定义"},[n("span",null,"类型定义")])],-1)),n("table",null,[s[17]||(s[17]=n("thead",null,[n("tr",null,[n("th",null,"类型"),n("th",null,"描述")])],-1)),n("tbody",null,[n("tr",null,[n("td",null,[e(a,{to:"/api/types.html#communicator"},{default:l(()=>[...s[7]||(s[7]=[p("Communicator",-1)])]),_:1})]),s[8]||(s[8]=n("td",null,"通讯器接口",-1))]),n("tr",null,[n("td",null,[e(a,{to:"/api/types.html#postresponse"},{default:l(()=>[...s[9]||(s[9]=[p("PostResponse",-1)])]),_:1})]),s[10]||(s[10]=n("td",null,"响应数据结构",-1))]),n("tr",null,[n("td",null,[e(a,{to:"/api/types.html#postrequest"},{default:l(()=>[...s[11]||(s[11]=[p("PostRequest",-1)])]),_:1})]),s[12]||(s[12]=n("td",null,"请求数据结构",-1))]),n("tr",null,[n("td",null,[e(a,{to:"/api/types.html#channeloption"},{default:l(()=>[...s[13]||(s[13]=[p("ChannelOption",-1)])]),_:1})]),s[14]||(s[14]=n("td",null,"配置选项",-1))]),n("tr",null,[n("td",null,[e(a,{to:"/api/types.html#publishoptions"},{default:l(()=>[...s[15]||(s[15]=[p("PublishOptions",-1)])]),_:1})]),s[16]||(s[16]=n("td",null,"发布选项",-1))])])]),s[27]||(s[27]=n("h2",{id:"枚举",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#枚举"},[n("span",null,"枚举")])],-1)),n("table",null,[s[22]||(s[22]=n("thead",null,[n("tr",null,[n("th",null,"枚举"),n("th",null,"描述")])],-1)),n("tbody",null,[n("tr",null,[n("td",null,[e(a,{to:"/api/types.html#returncode"},{default:l(()=>[...s[18]||(s[18]=[p("ReturnCode",-1)])]),_:1})]),s[19]||(s[19]=n("td",null,"返回码枚举",-1))]),n("tr",null,[n("td",null,[e(a,{to:"/api/errors.html#errorcode"},{default:l(()=>[...s[20]||(s[20]=[p("ErrorCode",-1)])]),_:1})]),s[21]||(s[21]=n("td",null,"错误码枚举",-1))])])]),s[28]||(s[28]=o(`<h2 id="快速参考" tabindex="-1"><a class="header-anchor" href="#快速参考"><span>快速参考</span></a></h2><h3 id="iframechannel" tabindex="-1"><a class="header-anchor" href="#iframechannel"><span>IframeChannel</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> IframeChannel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;postmessage-duplex&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 父页面</span></span>
<span class="line"><span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IframeChannel</span><span class="token punctuation">(</span>iframe<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 子页面</span></span>
<span class="line"><span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IframeChannel</span><span class="token punctuation">(</span>parentOrigin<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 方法</span></span>
<span class="line"><span class="token keyword">await</span> channel<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>cmdname<span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span>  <span class="token comment">// 发送并等待响应</span></span>
<span class="line"><span class="token keyword">await</span> <span class="token function">channel</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> params<span class="token punctuation">)</span>           <span class="token comment">// 类型安全的远程调用</span></span>
<span class="line">channel<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>cmdname<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>             <span class="token comment">// 订阅消息</span></span>
<span class="line">channel<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span>cmdname<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>                  <span class="token comment">// 一次性订阅</span></span>
<span class="line">channel<span class="token punctuation">.</span><span class="token function">unSubscribe</span><span class="token punctuation">(</span>cmdname<span class="token punctuation">)</span>                     <span class="token comment">// 取消订阅</span></span>
<span class="line">channel<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                <span class="token comment">// 销毁通道</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 属性</span></span>
<span class="line">channel<span class="token punctuation">.</span>isReady      <span class="token comment">// boolean - 是否就绪</span></span>
<span class="line">channel<span class="token punctuation">.</span>isSon        <span class="token comment">// boolean - 是否为子页面</span></span>
<span class="line">channel<span class="token punctuation">.</span>isDestroyed  <span class="token comment">// boolean - 是否已销毁</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="serviceworkerchannel" tabindex="-1"><a class="header-anchor" href="#serviceworkerchannel"><span>ServiceWorkerChannel</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ServiceWorkerChannel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;postmessage-duplex&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 页面端</span></span>
<span class="line"><span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">await</span> ServiceWorkerChannel<span class="token punctuation">.</span><span class="token function">createFromPage</span><span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Worker 端</span></span>
<span class="line"><span class="token keyword">const</span> channel <span class="token operator">=</span> ServiceWorkerChannel<span class="token punctuation">.</span><span class="token function">createFromEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> channel <span class="token operator">=</span> ServiceWorkerChannel<span class="token punctuation">.</span><span class="token function">createFromWorker</span><span class="token punctuation">(</span>clientId<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 方法与 IframeChannel 相同</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置选项" tabindex="-1"><a class="header-anchor" href="#配置选项"><span>配置选项</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">ChannelOption</span> <span class="token punctuation">{</span></span>
<span class="line">  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>                <span class="token comment">// 默认 5000ms</span></span>
<span class="line">  log<span class="token operator">?</span><span class="token operator">:</span> Console                   <span class="token comment">// 自定义日志</span></span>
<span class="line">  subscribeMap<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">Function</span><span class="token operator">&gt;</span>  <span class="token comment">// 预定义订阅</span></span>
<span class="line">  maxMessageSize<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>         <span class="token comment">// 最大消息大小</span></span>
<span class="line">  rateLimit<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>              <span class="token comment">// 速率限制</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="发布选项" tabindex="-1"><a class="header-anchor" href="#发布选项"><span>发布选项</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">PublishOptions</span> <span class="token punctuation">{</span></span>
<span class="line">  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>               <span class="token comment">// 覆盖默认超时</span></span>
<span class="line">  transferables<span class="token operator">?</span><span class="token operator">:</span> Transferable<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 可传输对象</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="返回码" tabindex="-1"><a class="header-anchor" href="#返回码"><span>返回码</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">enum</span> ReturnCode <span class="token punctuation">{</span></span>
<span class="line">  Success <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>                    <span class="token comment">// 成功</span></span>
<span class="line">  ReceiverCallbackError <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>     <span class="token comment">// 接收方回调错误</span></span>
<span class="line">  SendCallbackError <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>         <span class="token comment">// 发送方回调错误</span></span>
<span class="line">  NoSubscribe <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>               <span class="token comment">// 未订阅</span></span>
<span class="line">  TimeOut <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">99</span>                   <span class="token comment">// 超时</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="导入" tabindex="-1"><a class="header-anchor" href="#导入"><span>导入</span></a></h2><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// 命名导入</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> </span>
<span class="line">  IframeChannel<span class="token punctuation">,</span></span>
<span class="line">  ServiceWorkerChannel<span class="token punctuation">,</span></span>
<span class="line">  ChannelError<span class="token punctuation">,</span></span>
<span class="line">  ReturnCode<span class="token punctuation">,</span></span>
<span class="line">  ErrorCode<span class="token punctuation">,</span></span>
<span class="line">  createConnectionDestroyedError<span class="token punctuation">,</span></span>
<span class="line">  createTimeoutError<span class="token punctuation">,</span></span>
<span class="line">  createHandlerError</span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;postmessage-duplex&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 类型导入</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span></span>
<span class="line">  PostResponse<span class="token punctuation">,</span></span>
<span class="line">  PostRequest<span class="token punctuation">,</span></span>
<span class="line">  PostCallback<span class="token punctuation">,</span></span>
<span class="line">  ChannelOption<span class="token punctuation">,</span></span>
<span class="line">  PublishOptions<span class="token punctuation">,</span></span>
<span class="line">  Communicator<span class="token punctuation">,</span></span>
<span class="line">  Methods<span class="token punctuation">,</span></span>
<span class="line">  MethodParams<span class="token punctuation">,</span></span>
<span class="line">  MethodReturn<span class="token punctuation">,</span></span>
<span class="line">  TypedPostResponse</span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;postmessage-duplex&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13))])}const v=t(u,[["render",d]]),b=JSON.parse('{"path":"/api/","title":"API 参考","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1769418463000,"contributors":[{"name":"liquidliang","username":"liquidliang","email":"ljquan@qq.com","commits":1,"url":"https://github.com/liquidliang"}],"changelog":[{"hash":"288e378422593e39667c397bec9bbbf25465b67a","time":1769418463000,"email":"ljquan@qq.com","author":"liquidliang","message":"init"}]},"filePathRelative":"api/README.md"}');export{v as comp,b as data};
